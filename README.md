# å†™åœ¨å‰é¢
#### ä»€ä¹ˆæ˜¯æµèºä¹¦ç­¾
â€œæµèºâ€æ˜¯æˆ‘éå¸¸å–œæ¬¢çš„ä¸€ä¸ªè¯ï¼Œæœ¬æŒ‡å››å¤„é£ç¿”é¸£å”±çš„èºé¸Ÿï¼Œå°±åƒæˆ‘æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆéšæ€§çš„äººã€‚â€œæµèºä¹¦ç­¾â€æ˜¯ä¸€ä¸ªç”¨æ¥ç»Ÿä¸€å­˜æ”¾ã€ç®¡ç†æ”¶è—ç½‘å€çš„ç½‘ç«™ï¼Œè™½ç„¶æµè§ˆå™¨æœ¬èº«è‡ªå¸¦æ”¶è—å¤¹åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜èƒ½åˆ›å»ºå¤šä¸ªæ–‡ä»¶å¤¹ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—æŸ¥æ‰¾èµ·æ¥ä¾ç„¶å¾ˆè´¹åŠ²ï¼Œå¹¶ä¸”å®ƒé•¿çš„å¾ˆä¸‘ã€‚æ‰€ä»¥æˆ‘å°±æƒ³åšä¸€ä¸ªå¥½ç”¨åˆå¥½çœ‹çš„æ”¶è—å¤¹ï¼Œå–åâ€œæµèºä¹¦ç­¾â€ã€‚
#### ä¸ºä»€ä¹ˆä¼šæœ‰æµèºä¹¦ç­¾
åœ¨å¼€å§‹è¿™ä¸ªé¡¹ç›®ä¹‹å‰ï¼Œå…¬å¸ä¸€ç›´ä½¿ç”¨çš„æ˜¯`VUE2`ç³»åˆ—+`JS`ï¼Œä»¥åŠæˆ‘ğŸ‘‰ğŸ‘‰[è‡ªå·±çš„åšå®¢](https://www.duwanyu.com)ä¹Ÿæ˜¯åŸºäº`VUE2`çš„ï¼Œåœ¨`VUE3`æ­£å¼ç‰ˆå‘å¸ƒä»¥åï¼Œä¸€æ–¹é¢æ˜¯å…¬å¸æœ‰å‡çº§`VUE3`çš„æ‰“ç®—ï¼Œå¦å¤–ä¹Ÿæ˜¯æƒ³å­¦ä¹ æ›´å¤šçš„æŠ€æœ¯ï¼Œæå‡è‡ªå·±çš„èƒ½åŠ›å’Œç«äº‰åŠ›ï¼Œå†åŠ ä¸Š`TS`çœ‹è¿‡æœ‰ä¸€æ®µæ—¶é—´äº†ä¹Ÿæ²¡æœ‰ç»ƒè¿‡ï¼Œæ­£å¥½ä¸€èµ·ç»ƒç»ƒæ‰‹ã€‚
#### é¡¹ç›®åœ°å€
ğŸ‘‰ğŸ‘‰[é¡¹ç›®é¢„è§ˆåœ°å€](https://alanhzw.github.io)ï¼Œå¯ä»¥ç›´æ¥è®¾ç½®ä¸ºæµè§ˆå™¨ä¸»é¡µæˆ–è€…æ¡Œé¢å¿«æ·æ–¹å¼è¿›è¡Œä½¿ç”¨
#### æºç åœ°å€
å®Œå…¨å¼€æºï¼Œå¤§å®¶å¯ä»¥éšæ„ç ”ç©¶ï¼ŒäºŒæ¬¡å¼€å‘ã€‚å½“ç„¶è¿˜æ˜¯ååˆ†æ¬¢è¿å¤§å®¶ç‚¹ä¸ªStarâ­â­â­  
ğŸ‘‰ğŸ‘‰[æºç é“¾æ¥(gitee)](https://gitee.com/hzw_0174/WarblerHomepage) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ğŸ‘‰ğŸ‘‰[æºç é“¾æ¥(github)](https://github.com/alanhzw/WarblerHomepage)
#### é¡¹ç›®å±•ç¤º
![image](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3defbf432068468ab1e2704980b0d895~tplv-k3u1fbpfcp-watermark.image)

# é¡¹ç›®ç›®å½•
åŸºæœ¬æ˜¯ä¸€ä¸ªæ ‡å‡†çš„**è„šæ‰‹æ¶å·¥ç¨‹ç›®å½•**ï¼ŒåŸºç¡€ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶åˆ†å¼€å­˜æ”¾ï¼Œæ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹ä¸‹ä¸€ä¸ª`VUEæ–‡ä»¶`ï¼Œä¸€ä¸ª`TSæ–‡ä»¶`ï¼Œ`TSæ–‡ä»¶`ä¸»è¦å­˜æ”¾ä¸€äº›æ•°æ®å’Œç±»å‹å£°æ˜ã€‚

```js
â”œâ”€â”€ src 
     â”œâ”€â”€ assets      // å­˜æ”¾é™æ€èµ„æº
     â”œâ”€â”€ baseComponents  // åŸºç¡€ç»„ä»¶
     â”‚    â””â”€â”€Form    // è¡¨å•ç»„ä»¶
     â”‚    â”‚    â”œâ”€â”€Form.vue
     â”‚    â”‚    â””â”€â”€index.ts
     â”‚    â”œâ”€â”€ Input    // è¾“å…¥æ¡†ç»„ä»¶
     â”‚    â”‚    â”œâ”€â”€Input.vue
     â”‚    â”‚    â””â”€â”€index.ts   
         â”‚      ....
     â”œâ”€â”€ components  // ä¸šåŠ¡ç»„ä»¶
     â”‚   â”œâ”€â”€ BookMark    // é¡µé¢ä¸»è¦å†…å®¹ç›¸å…³ç»„ä»¶
     â”‚   â”‚     â”œâ”€â”€BookMark.vue
     â”‚   â”‚     â”œâ”€â”€useLabels.ts
     â”‚   â”‚     â””â”€â”€index.ts   
     â”‚   .....
     â”œâ”€â”€ hooks       // å°è£…çš„ä¸€äº›å¤ç”¨é€»è¾‘
     â”œâ”€â”€ styles      // æ ·å¼
     â”œâ”€â”€ utils       // å­˜æ”¾è‡ªå·±å°è£…çš„å·¥å…·
     â”œâ”€â”€ APP.vue
     â””â”€â”€ main.ts
```

# é¡¹ç›®åŠŸèƒ½/ç‰¹è‰²
## åŠŸèƒ½
#### âœ…æ ‡ç­¾æ“ä½œ
ä¹Ÿå°±æ˜¯åˆ†ç±»ï¼Œæ”¯æŒå¢åŠ ã€åˆ é™¤ï¼Œä¿®æ”¹çš„æ“ä½œ

#### âœ…ä¹¦ç­¾æ“ä½œ  
ä¹Ÿå°±æ˜¯ä¿å­˜ä¸‹æ¥çš„ç½‘å€ï¼Œæ”¯æŒå¢åŠ ã€åˆ é™¤ï¼Œä¿®æ”¹çš„æ“ä½œ

#### âœ…æœç´¢  
å¯ä»¥åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥å†…å®¹åç‚¹å‡»å¯¹åº”çš„å›¾æ ‡è¿›è¡Œæœç´¢ï¼Œç›®å‰æ”¯æŒç™¾åº¦ã€è°·æ­Œã€å¿…åº”ï¼Œå›è½¦é»˜è®¤ä½¿ç”¨ç™¾åº¦æœç´¢

#### âœ…ç¿»è¯‘  
ç‚¹å‡»ç¿»è¯‘å›¾æ ‡å¯ä»¥å¿«æ·è¿›è¡Œç¿»è¯‘ï¼Œç›®å‰æ”¯æŒç™¾åº¦

#### âœ…å¯¼å‡ºï¼Œå¯¼å…¥é…ç½®  
ç”±äºæ²¡æœ‰è´¦å·åŠŸèƒ½ï¼Œæ‰€ä»¥ä¸ºäº†è®©è¾›è¾›è‹¦è‹¦ç§¯ç´¯çš„æ•°æ®ä¸ä¼šä¸¢å¤±ï¼Œæˆ–è€…å‘å°ä¼™ä¼´ä»¬åˆ†äº«è‡ªå·±çš„æ”¶è—ï¼Œæ”¯æŒé…ç½®çš„å¯¼å‡ºå¤‡ä»½å’Œå¯¼å…¥æ¢å¤

## ç‰¹è‰²
#### ğŸ’localStorage
é¡¹ç›®ä½¿ç”¨`localStorage`å­˜å‚¨æ•°æ®ï¼Œæ‰€ä»¥ä¸è¦éšæ„æ¸…é™¤ç¼“å­˜ï¼Œé™¤éä½ å·²ç»åšå¥½å¤‡ä»½ï¼Œä¸ç„¶æ‰€æœ‰çš„æ”¶è—éƒ½ä¼šä»˜ä¹‹ä¸€ç‚¬äº†

#### ğŸ’è‡ªåŠ¨è·å–
è¾“å…¥ç›®æ ‡ç½‘å€åå¯ä»¥è‡ªåŠ¨è·å–å›¾æ ‡å’Œæ ‡é¢˜ï¼Œä½†æ˜¯æ¥å£èƒ½åŠ›æœ‰é™ï¼Œå¹¶ä¸èƒ½é€‚ç”¨äºæ‰€æœ‰ç½‘ç«™ï¼Œæ‰€ä»¥æ”¯æŒæ‰‹åŠ¨è¾“å…¥ï¼Œä¹Ÿå¯ä½¿ç”¨é»˜è®¤çš„å›¾æ ‡

#### ğŸ’åŸºç¡€ç»„ä»¶
é¡¹ç›®æ²¡æœ‰ä½¿ç”¨ä»»ä½•çš„ç»„ä»¶åº“ï¼Œè‡ªå·±å°è£…äº†ä¸€äº›åŸºç¡€ç»„ä»¶ï¼Œæ¯”å¦‚`Dialog`ï¼Œ`Message`ï¼Œ`Input`ï¼Œ`Form`ç­‰

## é¡¹ç›®æ²¡æœ‰ä½¿ç”¨çš„
#### âvue-router4ï¼Œvuex4
`vue3`ç”Ÿæ€å‡ºäº†é…å¥—çš„`vue-router4`ï¼Œ`vuex4`ï¼Œä½†ç”±äºé¡¹ç›®æœ¬èº«å¹¶ä¸å¤æ‚ï¼Œæ‰€ä»¥æ²¡æœ‰ç”¨åˆ°ï¼Œå¯èƒ½éšç€åŠŸèƒ½çš„æ‰©å……ï¼Œä»¥åä¼šæ·»åŠ ã€‚

#### âï¼œscript setupï¼
è¿™ä¸ªè¯­æ³•ç³–å€’æ˜¯äº†è§£è¿‡ï¼Œä½†æ˜¯æ¯•ç«Ÿæ˜¯åˆå­¦`vue3`ï¼Œæ‰€ä»¥è¿˜æ˜¯å†³å®šå…ˆæå¥½åŸºç¡€ï¼Œå†æ**éªšæ“ä½œ**ï¼Œä»¥åä¹Ÿè®¸ä¼šæ‰¾å‡ ä¸ªé¡µé¢è¯•ä¸€è¯•è¿™ä¸ªè¯­æ³•ç³–ã€‚

# é‡ç‚¹ä»‹ç»
ç”±äºç¯‡å¹…è¿‡é•¿ï¼Œå¯¹äºç»„ä»¶çš„ä»‹ç»ç‹¬ç«‹æˆæ–‡ç« ï¼Œç›´æ¥ç‚¹å‡»é“¾æ¥è¿›è¡Œè·³è½¬æŸ¥çœ‹ã€‚

## é¡¹ç›®æ­å»º
ğŸ‘‰ğŸ‘‰[ä»é›¶æ­å»ºä¸€ä¸ªVite2+VUE3+TSå·¥ç¨‹](https://juejin.cn/post/6951302450892521480)

## å°è£…çš„åŸºç¡€ç»„ä»¶
ğŸ‘‰ğŸ‘‰[åŸºç¡€ç»„ä»¶(ä¸€):Buttonã€Overlayã€Dialogã€Message](https://juejin.cn/post/6963941445451382792)

ğŸ‘‰ğŸ‘‰[åŸºç¡€ç»„ä»¶(äºŒ):Formã€Input](https://juejin.cn/post/6963931012191485982)

## ä¸šåŠ¡ç»„ä»¶
ğŸ‘‰ğŸ‘‰ä¸šåŠ¡ç»„ä»¶ï¼Œæ•´ä½“å¸ƒå±€(æš‚æ— )

## å¯¼å…¥,å¯¼å‡ºé…ç½®
é¦–å…ˆæˆ‘æ˜¯å°è£…äº†ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼Œæ³¨é‡Šå†™çš„éå¸¸è¯¦ç»†

```js
//file.ts
import createMessage from 'base/Message/index';
// æ–‡ä»¶ä¸‹è½½
export const downloadFile = (jsonStr: any) => {
  // å°†æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²
  jsonStr = JSON.stringify(jsonStr);
  // åˆ›å»º blob å¯¹è±¡
  const blob = new Blob([jsonStr]);
  // åˆ›å»ºä¸€ä¸ªaæ ‡ç­¾
  const el = document.createElement('a');
  // åˆ›å»ºä¸€ä¸ª URL å¯¹è±¡å¹¶ä¼ ç»™ a çš„ href
  el.href = URL.createObjectURL(blob);
  // è®¾ç½®ä¸‹è½½çš„é»˜è®¤æ–‡ä»¶å
  el.download = 'æµèºä¹¦ç­¾æ•°æ®å¤‡ä»½.json';
  // æ¨¡æ‹Ÿç‚¹å‡»é“¾æ¥è¿›è¡Œä¸‹è½½
  el.click();
};
// æ–‡ä»¶ä¸Šä¼ 
export const uploadFile = (e: any) => {
  return new Promise((reject) => {
    // å¦‚æœæ²¡æœ‰é€‰æ‹©æ–‡ä»¶å°±ä»€ä¹ˆä¹Ÿä¸åš
    if (e.target.value === '' || e.target.files.length < 1) {
      return;
    }
    // å¦‚æœä¸æ˜¯jsonæ ¼å¼çš„æ–‡ä»¶,ç»™å‡ºæç¤º
    if (e.target.files[0].type !== 'application/json') {
      createMessage('è¯·ä¸Šä¼ ç”±æœ¬ç«™å¯¼å‡ºçš„jsonæ ¼å¼çš„æ–‡ä»¶ !');
      return;
    }
    // åˆ›å»º FileReaderå¯¹è±¡
    const reader = new FileReader();
    // æŠŠæ–‡ä»¶è¯»å–ä¸ºå­—ç¬¦ä¸²
    reader.readAsText(e.target.files[0]);
    // æ–‡ä»¶è¯»å–å®Œæˆ
    reader.onload = function (ev: any) {
      reject(ev);
    };
  });
};
```
åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œæˆ‘æ˜¯éšè—äº†ä¸Šä¼ æ–‡ä»¶çš„`input`ï¼Œç”¨ä¸€ä¸ªå›¾æ ‡æ¥æ¨¡æ‹Ÿç‚¹å‡»ä¸Šä¼ æŒ‰é’®ï¼Œæ–‡ä»¶è¯»å–æˆåŠŸåï¼Œè¿›å…¥`promise`çš„`reject`çŠ¶æ€ï¼Œç„¶åè¦éªŒè¯ä¸€ä¸‹ä¸Šä¼ çš„æ–‡ä»¶æ˜¯å¦ç¬¦åˆæ ¼å¼ã€‚å¦‚æœä¸ç¬¦åˆç»™å‡ºé”™è¯¯æç¤ºï¼Œç¬¦åˆçš„è¯å°±æ›¿æ¢ä¸€ä¸‹æ•°æ®ã€‚


```js
//è¿™é‡Œæ˜¯ç®€ç•¥è¿‡çš„ä¼ªä»£ç ,è¯¦æƒ…è¯·æŸ¥é˜…æºç 
<template>
  <i class="iconfont" @click='handleClick(1)'></i>
  <i class="iconfont" @click='handleClick(2)'></i>
  <input type="file" id="file-select" @change="handleUploadFile">
</template>

<script lang='ts'>
//æ­¤å¤„çœç•¥å¼•ç”¨
export default defineComponent({
  setup(props, { emit }) {
    // ç‚¹å‡»å›¾æ ‡çš„å¤„ç†å‡½æ•°
    const handleClick = (index:number) => {
      if (index === 1) {
        // è·å–typeä¸ºfileçš„inputå…ƒç´ 
        const input = document.querySelector('#file-select') as HTMLInputElement;
        // æ¨¡æ‹Ÿç‚¹å‡»
        input.click();
      }
      if (index === 2) {
        // ä»æµè§ˆå™¨æœ¬åœ°å–å‡ºæ•°æ®
        const warblerData = getItem('WARBLER_DATA');
        const themeData = getItem('THEME_DATA');
        // æ•´åˆæ•°æ®
        let jsonStr: any = {
          warblerData,
          themeData,
        };
        downloadFile(jsonStr);
      }
    };
    // è§¦å‘ä¸Šä¼ æ–‡ä»¶å‡½æ•°
    const handleUploadFile = (e: Event) => {
      uploadFile(e).then((ev: any) => {
        // ä¸ºä»€ä¹ˆè¦åŒ…è£¹ä¸€å±‚try catch, å› ä¸º JSON.parseåœ¨è½¬æ¢çš„æ—¶å€™,å¦‚æœæ ¼å¼ä¸ç¬¦åˆè¦æ±‚ä¼šæŠ¥é”™  å¦‚æœæŠ¥é”™è¯´æ˜ä¸Šä¼ çš„JSONä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„,ç»™å‡ºæç¤ºå³å¯
        try {
          // æŠŠ JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JSON å¯¹è±¡
          const jsonObj = JSON.parse(ev.target.result);
          // éªŒè¯JSONçš„æ ¼å¼æ˜¯ä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„æ ¼å¼
          const test = () => {
            // æ ‡å¿—å˜é‡
            let flag = true;
            // å¾ªç¯æˆ‘ä»¬éœ€è¦çš„key  åœ¨è¯»å–çš„æ–‡ä»¶ä¸­åˆ¤æ–­æ˜¯å¦å…·æœ‰æˆ‘ä»¬æ‰€éœ€è¦çš„æ‰€æœ‰keyå€¼  å¦‚æœæ²¡æœ‰å°±è¿”å›é”™è¯¯
            dataFormat.forEach((dataItem) => {
              const result = Object.keys(jsonObj).find((jsonItem) => dataItem === jsonItem);
              if (!result) {
                flag = false;
              }
            });
            return flag;
          };
          // å¦‚æœæ ¼å¼ä¸ç¬¦åˆæœ¬ç«™è¦æ±‚,ç»™å‡ºæç¤º
          if (!test()) {
            createMessage('è¯·ä¸Šä¼ ç”±æœ¬ç«™å¯¼å‡ºçš„jsonæ ¼å¼çš„æ–‡ä»¶ !');
            return;
          }
          // å¦‚æœç¬¦åˆè¦æ±‚  è§¦å‘æ›´æ–°æ•°æ®æ–¹æ³•
          emitter.emit('update-warblerData', jsonObj.warblerData);
        } catch (error) {
          createMessage('è¯·ä¸Šä¼ ç”±æœ¬ç«™å¯¼å‡ºçš„jsonæ ¼å¼çš„æ–‡ä»¶ !');
        }
      });
    };
  },
});
</script>
//æ­¤å¤„çœç•¥css,è¯¦æƒ…è¯·æŸ¥çœ‹æºç 
```
## è‡ªåŠ¨è·å–å›¾æ ‡
æœ¬èº«æ²¡æœ‰å†™çˆ¬è™«çš„ç»å†ï¼Œç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œç…§çŒ«ç”»è™çš„ç®€å•å†™äº†ä¸€ä¸ªçˆ¬å–ç½‘ç«™å›¾æ ‡å’Œæ ‡é¢˜çš„æ¥å£ã€‚æ‰€ä»¥æœ‰äº›ç½‘ç«™å°±çˆ¬ä¸ä¸‹æ¥ï¼Œå¦‚æœæœ‰æ›´å¥½çš„çˆ¬å–æ–¹å¼ï¼Œè¯·å¤§å®¶ä¸åèµæ•™ã€‚

æˆ‘çš„åšå®¢æ˜¯åŸºäº`express`çš„ï¼Œè€Œä¸”æ˜¯éƒ¨ç½²åœ¨æˆ‘è‡ªå·±æœåŠ¡å™¨ä¸Šçš„ï¼Œæ‰€ä»¥ç›´æ¥åäº†ä¸ªé¡ºé£è½¦ï¼Œåœ¨æˆ‘çš„åšå®¢é¡¹ç›®é‡Œå†™äº†è¿™ä¸ªæ¥å£ã€‚


```js
/*
 * @Description:è·å–ç½‘ç«™æ ‡é¢˜å’Œå›¾æ ‡çš„çˆ¬è™«
 * 1.æŸäº›ç½‘ç«™æœ‰å¤§ä½¬è®¾è®¡äº†åçˆ¬,æˆ‘å°±æ˜¯å†™äº†æœ€åŸºæœ¬çš„çˆ¬è™«,æ ¹æœ¬è¿›ä¸å»ç½‘ç«™
 * 2.æŸäº›ç½‘ç«™è™½ç„¶èƒ½è¿›å»,ä½†æ˜¯å›¾æ ‡ç»è¿‡äº†å„ç§éªšæ“ä½œ,æˆ‘æ‰¾ä¸åˆ°
 *   æ‰€ä»¥å‰ç«¯æ”¯æŒè‡ªåŠ¨è·å–å¤±è´¥çš„æ—¶å€™,æ‰‹åŠ¨é€‰æ‹©å›¾æ ‡
 * 3.é”™è¯¯ç  300 æ²¡æœ‰å¡«å†™ç½‘å€  301è¯·æ±‚å¤±è´¥
 * 4.è¯·æ±‚å¤±è´¥ ä¹Ÿä¼šåœ¨errorè¿”å›textå­—æ®µ é‡Œé¢åŒ…å«ç½‘ç«™å›¾æ ‡  åªä¸è¿‡å–ä¸åˆ°ç½‘ç«™å†…å®¹
 *   æˆ‘ä»¬ä¸éœ€è¦å†…å®¹ åªéœ€è¦titleå’Œicon æ‰€ä»¥æˆ‘ä»¬åœ¨é”™è¯¯å¤„ç†ä¸­ä¹Ÿè¿›è¡Œä¸€æ¬¡çˆ¬å–
 */
// ç”¨æ¥å‘é€è¯·æ±‚çš„æ¨¡å—
const superagent = require('superagent');
// ç”¨æ¥æ‰˜ç®¡htmlçš„æ¨¡å—
const cheerio = require('cheerio');

//è·å–ç½‘ç«™ä¸»åŸŸå
const getFinallyUrl = (targetUrl) => {
  //  å°†ç›®æ ‡åŸŸåä»¥â€œ//â€è¿›è¡Œåˆ†å‰²
  const urlArray = targetUrl.split('//');
  //å®šä¹‰æœ€ç»ˆçš„åŸŸå
  let finallyUrl = '';
  //è¿™ä¸ªåˆ¤æ–­çš„æ„æ€æ˜¯  å¦‚æœæ•°ç»„å­˜åœ¨ç¬¬[1]é¡¹  é‚£ä¹ˆè¯æ˜è¿™ä¸ªç½‘å€æ˜¯ä»¥http/httpså¼€å¤´çš„  å¦åˆ™å°±æ˜¯ä¸å¸¦æœ‰http/httpsçš„
  if (urlArray[1]) {
    //å¦‚æœå¸¦æœ‰http/https å’±ä»¬å°±æŠŠhttp/httpsç»™æ‹¼ä¸Šè¿”å›
    finallyUrl = urlArray[0] + '//' + urlArray[1];
  } else {
    //å¦‚æœä¸å¸¦æœ‰http/https å’±ä¹Ÿä¸çŸ¥é“æ˜¯httpè¿˜æ˜¯https  å°±è¿”å›åŸæ¥çš„å€¼
    finallyUrl = urlArray[0] + '/';
  }
  return finallyUrl;
};

//è·å–æœ€ç»ˆçš„å›¾æ ‡åœ°å€
const getFinallyIcon = (finallyUrl, icon) => {
  let finallyIcon = '';
  if (icon) {
    //è¿™ä¸ªåˆ¤æ–­çš„æ„æ€æ˜¯ å¦‚æœå­˜åœ¨://æˆ–è€…www. åˆ™è¯æ˜è·¯å¾„ä¸­æ˜¯ç»å¯¹è·¯å¾„  å¦åˆ™æ˜¯ç›¸å¯¹è·¯å¾„
    if (icon.indexOf('//') > -1 || icon.indexOf('www.') > -1) {
      //å¦‚æœæ˜¯ç»å¯¹è·¯å¾„ç›´æ¥ä½¿ç”¨
      finallyIcon = icon;
    } else {
      //å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„çš„è¯,å°±ç»™æ‹¼æ¥ä¸Šå½“å‰ç½‘ç«™çš„ä¸»åŸŸå
      finallyIcon = finallyUrl + icon;
    }
  }
  return finallyIcon;
};

//è·å–æ ‡é¢˜å’Œå›¾æ ‡åœ°å€
const getTitleAndIcon = (finallyUrl, text) => {
  //è·å–åˆ°çš„ç½‘é¡µæ˜¯æœ¬æ–‡æ ¼å¼,nodeè‡ªèº«æ— æ³•è§£æ,æ‰€ä»¥äº¤ç»™cheerioè¿›è¡Œæ‰˜ç®¡
  const $ = cheerio.load(text);
  //è·å–ç½‘ç«™æ ‡é¢˜
  const title = $('title').text();
  //ç”±äºä¸åŒç½‘ç«™çš„iconæ ¼å¼ä¸åŒ,è¿™é‡Œé¢„è®¾äº†å‡ ç§
  //ä½†æ˜¯ç”±äºæŸäº›ç½‘ç«™çš„å¤§ä½¬è¿›è¡Œäº†å„ç§åŒ…è£…,å¯¼è‡´åŸºæœ¬çš„çˆ¬å–æ–¹å¼è·å–ä¸åˆ°
  const icon1 = $("[rel='icon']").attr('href');
  const icon2 = $("[href$='.ico']").attr('href');
  const icon3 = $("[rel='shortcut icon']").attr('href');
  let icon = icon1 || icon2 || icon3;
  //è·å–æœ€ç»ˆå›¾æ ‡çš„åœ°å€
  const finallyIcon = getFinallyIcon(finallyUrl, icon);
  return {
    title,
    finallyIcon,
  };
};

module.exports = async (req, res) => {
  //ä»è¯·æ±‚ä½“é‡Œè·å–å°†è¦çˆ¬å–ç½‘ç«™çš„url
  const targetUrl = req.body.targetUrl;
  //åˆ¤æ–­ä¸€ä¸‹urlæ˜¯å¦ä¸ºç©º,è™½ç„¶å‰ç«¯ä¹Ÿä¼šæ ¡éªŒ
  if (!targetUrl) {
    return res.json({
      errorStatus: 300,
      errorMsg: 'ç›®æ ‡ç½‘å€è·¯å¾„ä¸å¯ä¸ºç©º',
    });
  }
  const finallyUrl = getFinallyUrl(targetUrl);
  //æ¨¡æ‹Ÿæ‰“å¼€å¯¹åº”urlçš„ç½‘é¡µ
  superagent
    .get(targetUrl)
    .then((superagentRes) => {
      //æˆåŠŸçš„è¯ç›´æ¥å–text
      const { title, finallyIcon } = getTitleAndIcon(finallyUrl, superagentRes.text);
      //æ¥å£è¿”å›æ ‡é¢˜å’Œå›¾æ ‡åœ°å€
      res.json({
        title: title,
        icon: finallyIcon,
      });
    })
    .catch((error) => {
      console.log('ğŸš€ğŸš€~ error:', error);
      //é”™è¯¯å¤„ç†
      //éƒ¨åˆ†ç½‘ç«™å¤±è´¥äº†ä¹Ÿä¼šæœ‰textå­—æ®µ  åªä¸è¿‡å–ä¸åˆ°ç½‘ç«™å†…å®¹   æˆ‘ä»¬ä¸éœ€è¦å†…å®¹ åªéœ€è¦titleå’Œicon
      const { title, finallyIcon } = getTitleAndIcon(finallyUrl, error.response.text);
      res.json({
        errorStatus: 301,
        errorMsg: error.message,
        title: title,
        icon: finallyIcon,
      });
    });
};
```
# æ¥ä¸‹æ¥çš„å¼€å‘è®¡åˆ’
ğŸ’¡æ”¯æŒæ ‡ç­¾ï¼Œä¹¦ç­¾çš„æ‹–æ‹½æ’åºï¼Œä»¥åŠå¯ä»¥æŠŠä¹¦ç­¾æ‹–åˆ°å…¶ä»–çš„æ ‡ç­¾ä¸­

ğŸ’¡ç§»åŠ¨ç«¯é€‚é…ï¼Œç°åœ¨åªæ”¯æŒç”µè„‘æµè§ˆå™¨

ğŸ’¡æ›´æ¢ä¸»é¢˜ï¼Œç½‘ç«™è‡ªèº«æä¾›æš—ã€äº®ä¸¤å¥—ä¸»é¢˜ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰



# é“¾æ¥æ•´åˆ
ğŸ”Šé¡¹ç›®é¢„è§ˆåœ°å€(GitHub Pages):ğŸ‘‰ğŸ‘‰https://alanhzw.github.io

ğŸ”Šé¡¹ç›®é¢„è§ˆå¤‡ç”¨åœ°å€(è‡ªå·±çš„æœåŠ¡å™¨):ğŸ‘‰ğŸ‘‰http://warbler.duwanyu.com

ğŸ”Šæºç åœ°å€(gitee):ğŸ‘‰ğŸ‘‰https://gitee.com/hzw_0174/warbler-homepage

ğŸ”Šæºç åœ°å€(github):ğŸ‘‰ğŸ‘‰https://github.com/alanhzw/WarblerHomepage

ğŸ”Šæµèºä¹¦ç­¾-ä»é›¶æ­å»ºä¸€ä¸ªVite+Vue3+Tsé¡¹ç›®:ğŸ‘‰ğŸ‘‰https://juejin.cn/post/6951302450892521480

ğŸ”Šæµèºä¹¦ç­¾-åŸºç¡€ç»„ä»¶ä»‹ç»(Form,Input):ğŸ‘‰ğŸ‘‰https://juejin.cn/post/6963931012191485982

ğŸ”Šæµèºä¹¦ç­¾-åŸºç¡€ç»„ä»¶(Button,Overlay,Dialog,Message):ğŸ‘‰ğŸ‘‰https://juejin.cn/post/6963941445451382792

ğŸ”Šæµèºä¹¦ç­¾-ä¸šåŠ¡ç»„ä»¶ä»‹ç»:ğŸ‘‰ğŸ‘‰æš‚æ— 

ğŸ”Šæˆ‘çš„åšå®¢:ğŸ‘‰ğŸ‘‰https://www.duwanyu.com


